/*! mtc-auth 28-01-2015 v2.0.1 */
!function(a){"use strict";function b(b,c){var d=Date.now();return b.expires_at=b.expires_at||d+1e3*b.expires_in-j,c.sessionStorage[k+"-"+i.client_id]=a.toJson(b),b}function c(b,c){var d=a.copy(b),e=d.oauth2_url+"?",f=c.hash.substring(1),g=c.origin+c.pathname;return e+="client_id="+d.client_id,e=d.scope.length?e+"&scope="+d.scope.join(" ").replace(/\s/g,"%20"):e,e=d.state===!0?e+"&state="+encodeURIComponent(f):a.isString(d.state)?e+"&state="+encodeURIComponent(d.state):e,e+="&response_type=token",e=d.redirect_uri===!0?e+"&redirect_uri="+g:e+"&redirect_uri="+d.redirect_uri,a.forEach(d.options,function(a,b){e+="&"+b+"="+a}),e}function d(a){var b,c={},d="",e=a.split("#");if(e.length>1)for("/"===e[1].charAt(0)&&(e[1]=e[1].substring(1)),d=e[1];b=l.exec(d);)c[decodeURIComponent(b[1])]=decodeURIComponent(b[2]);return c}function e(b,c){var d=!1;return a.forEach(c.content_urls,function(a){~b.indexOf(a)&&(d=!0)}),d}function f(b){i.state=b.state||i.state,i.redirect_uri=b.redirectUri||i.redirect_uri,a.isArray(b.contentUrls)&&a.forEach(b.contentUrls,function(a){-1===i.content_urls.indexOf(a)&&i.content_urls.push(a)}),i.popup=b.popup||i.popup,a.isArray(b.scope)&&a.forEach(b.scope,function(a){-1===i.scope.indexOf(a)&&i.scope.push(a)}),i.oauth2_url=b.oauth2Url||i.oauth2_url,i.client_id=b.clientId||i.client_id,i.options=a.extend({},i.options,b.options||{}),i.auto_auth=null==b.autoAuth?i.auto_auth:b.autoAuth}function g(e,g,h,j){function l(){function c(){a.element(j.document).find("body").removeAttr("oauth-hide")}if(!i.client_id||!i.redirect_uri||!i.oauth2_url)throw new Error("Missing required configuration options");var e=d(j.location.href);{if(!e.access_token||!e.expires_in)return!n.isAuthenticated()&&a.isObject(n.getToken())?void n.authenticate():n.isAuthenticated()?void c():void(i.auto_auth&&n.authenticate());if(m=!0,b(e,j),c(),e.state){var f=e.state.split("?");h.path(f[0]),h.search(d(f.slice(1).length?"#"+f.slice(1)[0]:""));var g=decodeURIComponent(j.location.href.split("#")[2]);g&&"undefined"!==g&&h.hash(g)}else~j.location.hash.indexOf("/access_token")&&(j.location.hash="")}}var m=!1,n={};return n.registerCallback=function(a){return!m||a()},n.authenticate=function(){var a=c(i,j.location);j.location.href=a,i.redirecting=!0},n.lateConfig=f,n.isAuthenticated=function(){var c=a.fromJson(j.sessionStorage[k+"-"+i.client_id]),d=(new Date).getTime(),e=a.isDefined(c)&&parseInt(c.expires_at)>d;return e&&b(c,j),e},n.wasAuthenticated=function(){return a.isDefined(a.fromJson(j.sessionStorage[k+"-"+i.client_id]))},n.updateToken=function(){var d=g.defer();return e.get("$http")({url:c(i,j.location),method:"GET",withCredentials:!0,headers:{Accept:"application/json"}}).success(function(c){return a.isObject(c)?void d.resolve(b(c,j)):void d.reject("Token was not received as JSON")}).error(function(){console.warn("Attempted to retrieve token async, fallback to default method"),d.reject("Couldn't get token, re-authenticate"),n.authenticate()}),d.promise},n.getConfig=function(){return a.copy(i)},n.getToken=function(){return a.fromJson(j.sessionStorage[k+"-"+i.client_id])},l(),n}function h(a,c){c.defaults.useXDomain=!0,delete c.defaults.headers.common["X-Requested-With"],a.factory("authInterceptor",["$oauth2","$q","$window",function(a,c,d){return{request:function(f){if(e(f.url,i)){if(a.isAuthenticated())return f.headers.Authorization="Bearer "+a.getToken().access_token,f;if(!a.isAuthenticated()&&(a.wasAuthenticated()||i.auto_auth)&&!i.redirecting){var g=a.updateToken().then(function(a){return f.headers.Authorization="Bearer "+a.access_token,b(a,d),c.when(f)},function(){return c.reject("Invalid token cant be used for request")});return g}}return f}}}]),c.interceptors.push("authInterceptor")}a.module("angular-oauth2",[]);var i={redirecting:!1,content_urls:[],popup:!1,scope:[],options:{},auto_auth:!0},j=3e5,k="angular-oauth2",l=/([^&=]+)=([^&]*)/g;h.prototype.$get=["$injector","$q","$location","$window",g],h.prototype.configure=f,a.module("angular-oauth2").provider("$oauth2",["$provide","$httpProvider",h]),a.module("angular-oauth2").constant("oauth2-key",k)}(angular);